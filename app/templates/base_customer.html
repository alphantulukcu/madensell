<!DOCTYPE html>
<html lang="en">
<head>
       <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="/static/default_dark.css" id="theme-stylesheet" rel="stylesheet" type="text/css" media="all">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs/build/css/alertify.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs/build/css/themes/default.min.css" />
</head>
<body class="flex flex-col min-h-screen">

<div class="container mx-auto">
    <div class="navbar fixed top-0 left-0 right-0" id="navbar">
        <div class="navbar-brand">
            <a href="" class="btn" id="logo">
                <img src="/static/logo_white.png" alt="Logo" id="logoImg">
            </a>
            <h1>{% block title %} {% endblock %}</h1>
        </div>
        <form action="" method="get" class="flex items-center">
            <input id="query" type="text" name="query" placeholder="Search..." class="search-box" required>
            <button type="submit" class="btn px-4 py-2 text-white rounded-r"><i class="icon-color fa-solid fa-magnifying-glass"></i></button>
        </form>
        <div class="navbar-menu" id="navbar-menu">
            <!-- Add navigation links here -->
            <a href="{{url_for('market')}}" class="btn"><i class="icon-color fa-solid fa-cart-shopping"></i> Market</a>
            <a href="{{url_for('profile')}}" class="btn"><i class="icon-color fa-solid fa-user"></i> Profile</a>
            <a href="{{url_for('basket', product_id=0)}}" class="btn"><i class="icon-color fa-solid fa-user"></i> Basket</a>
            <a href="#" class="btn" onclick="toggleWalletVisibility(event);"><i class="icon-color fa-solid fa-user"></i> Wallet</a>
            <a href="{{url_for('logout')}}" class="btn"><i class="icon-color fa-solid fa-right-from-bracket"></i> Logout</a>
                    <!-- Wallet card container -->
            <div class="wallet-card" id="walletCard">
                <div class="detailed-post">
                    <div class="detailed-post-content">
                        <h2>Your Wallet:</h2>
                        <h1 style="color: #FFFFFF">Total Balance:</h1>
                        <h3 id="walletBalance">Loading...</h3> <!-- Element to display the wallet balance -->
                    </div>
                    <form id="walletForm" style="width: 100%; display: flex; flex-direction: row; height: 3rem; font-size: 1rem; margin-top: 0.5rem">
                        <input type="number" class="form-input" style="width: 1rem;" name="insert_amount">
                        <button class="settings-button" type="submit" style="margin-left: 0.5rem">Transfer Amount</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <div class="top-container">
        {%  block content %}
        {%  endblock %}
    </div>
</div>

<div class="bottom-navbar">
    <div class="bottom-navbar-menu">
        <!-- Add navigation links here -->
        <a href="" class="btn"><i class="fa-solid fa-plus"></i></a>
        <a href="" class="btn"><i class="fa-solid fa-cart-shopping" style="color: #ffffff;"></i></a>
        <a href="" class="btn"><i class="fa-solid fa-newspaper" style="color: #ffffff;"></i></a>
        <a href="" class="btn"><i class="fa-solid fa-user"></i></a>
        <a href="" class="btn"><i class="fa-solid fa-inbox" style="color: #ffffff;"></i></a>
        <a href="" class="btn"><i class="fa-solid fa-right-from-bracket"></i></a>
    </div>
</div>


<footer class="footer">
    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
        <div class="col-span-2 md:col-span-1">
            <h4 class="text-lg font-semibold mb-2">Navigation</h4>
            <ul class="list-none p-0 m-0">

            </ul>
        </div>
        <div class="col-span-2 md:col-span-1 mx-auto justify-center">
            <h4 class="text-lg font-semibold mb-2">Communication</h4>
            <ul class="list-none p-0 m-0">
                <li>info@madensell.com.tr</li>
                <li>0 (312) 266 2626</li>
                <li>Bilkent University, Ankara</li>
            </ul>
        </div>
        <div class="col-span-2 md:col-span-1 mx-auto justify-center">
            <a href="#" class="mx-2">Facebook</a>
            <a href="#" class="mx-2">Twitter</a>
            <a href="#" class="mx-2">LinkedIn</a>
            <a href="https://www.instagram.com/madensellbilkent/" target="_blank" class="mx-2">Instagram</a>
        </div>
    </div>

    <a href="https://w3.bilkent.edu.tr/www/" target="_blank" class="btn">
        <img class="mt-4 " src="/static/bilkent.png" alt="Bilkent">
    </a>
    <p class="mt-4">&copy; 2024 Fackd by Bilkent University. All rights reserved.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/alertifyjs/build/alertify.min.js"></script>
<script type="text/javascript">
    alertify.set('notifier','position', 'top-right');
    window.onload = function() {
        {% if message %}
        var messageType = "{{ message_type }}";
        if(messageType === 'error') {
            alertify.error("{{ message }}", 4);
        } else if(messageType === 'success') {
            alertify.success("{{ message }}", 4);
        }
        {% endif %}
    }
</script>
<script>
async function fetchWalletInfo() {
    try {
        const response = await fetch('/wallet');
        const data = await response.json();
        if (response.ok) {
            document.getElementById('walletBalance').textContent = `${data.balance}â‚º`;
        } else {
            console.error('Failed to fetch wallet info:', data.error);
            document.getElementById('walletBalance').textContent = 'Failed to fetch balance';
        }
    } catch (error) {
        console.error('Error fetching wallet info:', error);
        document.getElementById('walletBalance').textContent = 'Error fetching balance';
    }
}


async function updateWalletAmount(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    try {
        const response = await fetch('/wallet', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        if (response.ok) {
            alert('Amount added: ' + formData.get('insert_amount'));
            fetchWalletInfo(); // Update wallet info on page
        } else {
            alert('Error: ' + data.message);
        }
    } catch (error) {
        console.error('Error updating wallet:', error);
    }
}

document.addEventListener('DOMContentLoaded', function () {
    const walletForm = document.querySelector('#walletForm');
    walletForm.addEventListener('submit', updateWalletAmount);
    fetchWalletInfo(); // Fetch wallet info on page load
});

</script>

<script >
function toggleWalletVisibility(event) {
    event.preventDefault(); // Prevent the default anchor click behavior
    var walletCard = document.getElementById('walletCard');
    if (walletCard.classList.contains('expanded')) {
        walletCard.classList.remove('expanded');
    } else {
        walletCard.classList.add('expanded');
        fetchWalletInfo(); // Fetch wallet info when expanded
    }
}


</script>
</body>
</html>
